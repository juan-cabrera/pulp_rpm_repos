---

- name: config | Waiting end of task
  uri:
    url: "{{ pulp_api_server }}{{ task_href }}"
    user: "{{ pulp_admin_user }}"
    password: "{{ pulp_default_admin_password }}"
    method: GET
    force_basic_auth: yes
    status_code: 200
  register: task
  until: task.json.state != "running"
  changed_when: "'completed' in task.json.state"
  retries: 120
  delay: 10

- name: config | Check end task status
  uri:
    url: "{{ pulp_api_server }}{{ task_href }}"
    user: "{{ pulp_admin_user }}"
    password: "{{ pulp_default_admin_password }}"
    method: GET
    force_basic_auth: yes
    status_code: 200
  register: task
  failed_when: "not 'completed' in task.json.state"

